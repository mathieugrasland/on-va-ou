<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - On va où ?</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBs1O6cYYxNLE2vB9gEcmhEhONrditDyCo",
            authDomain: "on-va-ou-470217.firebaseapp.com",
            projectId: "on-va-ou-470217",
            storageBucket: "on-va-ou-470217.firebasestorage.app",
            messagingSenderId: "687464295451",
            appId: "1:687464295451:web:b228ea2a0ddc668e5f1cbe",
            measurementId: "G-2PCHXTT6DW"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            const userNameElement = document.getElementById('user-name');
            const logoutBtn = document.getElementById('logout-btn');

            // Vérifier l'authentification
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    console.log('Utilisateur connecté:', user.uid);
                    try {
                        // Récupérer les informations utilisateur depuis Firestore
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            userNameElement.textContent = userData.firstName || 'Utilisateur';
                            console.log('Données utilisateur:', userData);
                        } else {
                            console.log('Document utilisateur non trouvé');
                            userNameElement.textContent = 'Utilisateur';
                        }
                    } catch (error) {
                        console.error('Erreur lors de la récupération du profil:', error);
                        userNameElement.textContent = 'Utilisateur';
                    }
                } else {
                    console.log('Aucun utilisateur connecté, redirection...');
                    // Rediriger vers la page de connexion si non authentifié
                    window.location.href = 'login.html';
                }
            });

            // Gestion de la déconnexion
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        console.log('Déconnexion réussie');
                        window.location.href = 'index.html';
                    } catch (error) {
                        console.error('Erreur lors de la déconnexion:', error);
                        alert('Erreur lors de la déconnexion');
                    }
                });
            }
        });
    </script>
</head>
<body>
    <div class="background-image"></div>
    <div class="container">
        <h1>Salut <span id="user-name">...</span> !</h1>
        <p>Bientôt ici tu pourras voir les bars proposés...</p>
        <div class="actions">
            <button id="logout-btn" class="button button-secondary">Se déconnecter</button>
        </div>
    </div>
</body>
</html>