<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Profil utilisateur - On va où ? Complétez vos informations">
    <meta name="theme-color" content="#5d4037">
    <title>Mon Profil - On va où ?</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
        import { doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs, arrayUnion, arrayRemove } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

        // Fonction utilitaire pour afficher des messages
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                max-width: 400px;
                background: ${type === 'error' ? '#f44336' : '#4caf50'};
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        let currentUser = null;
        let userProfile = null;
        let isNewUser = false;

        // Vérifier l'authentification
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadUserProfile();
            } else {
                window.location.href = 'login.html';
            }
        });

        // Charger le profil utilisateur
        async function loadUserProfile() {
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                if (userDoc.exists()) {
                    userProfile = userDoc.data();
                    
                    // Vérifier et réparer la structure du profil
                    const needsRepair = await checkAndRepairProfile();
                    
                    // Distinguer entre "vraiment nouveau" (pas de firstName/lastName) et "profil incomplet"
                    const hasBasicInfo = userProfile.firstName?.trim() && userProfile.lastName?.trim();
                    const hasCompleteProfile = hasBasicInfo && 
                                             userProfile.address?.trim() && 
                                             userProfile.transportMode?.trim() && 
                                             userProfile.preferences?.trim();
                    
                    // Si l'utilisateur a au moins un nom/prénom, ne pas le traiter comme "nouveau"
                    isNewUser = !hasBasicInfo;
                    
                    console.log('Profile check:', {
                        needsRepair,
                        hasBasicInfo,
                        hasCompleteProfile,
                        isNewUser,
                        profileCompleted: userProfile.profileCompleted,
                        firstName: userProfile.firstName,
                        lastName: userProfile.lastName
                    });
                    
                    updateUI();
                    hideLoading();
                    
                    // Charger les amis seulement si le profil est structurellement valide
                    if (!needsRepair) {
                        await loadFriends();
                    }
                } else {
                    // Nouvel utilisateur - créer un profil par défaut
                    console.log('Nouveau utilisateur détecté, création du profil par défaut...');
                    
                    userProfile = {
                        firstName: '',
                        lastName: '',
                        email: currentUser.email || '',
                        createdAt: new Date().toISOString(),
                        profileCompleted: false,
                        address: '',
                        transportMode: '',
                        preferences: '',
                        friends: [],
                        friendRequests: {
                            sent: [],
                            received: []
                        }
                    };
                    
                    try {
                        await setDoc(doc(db, 'users', currentUser.uid), userProfile);
                        console.log('Profil par défaut créé avec succès');
                    } catch (error) {
                        console.error('Erreur création profil par défaut:', error);
                        showMessage('Erreur lors de la création du profil', 'error');
                    }
                    
                    isNewUser = true;
                    updateUI();
                    hideLoading();
                }
            } catch (error) {
                console.error('Erreur chargement profil:', error);
                showMessage('Erreur lors du chargement des données', 'error');
                hideLoading(); // Important : arrêter le loading même en cas d'erreur
            }
        }

        // Vérifier et réparer la structure du profil
        async function checkAndRepairProfile() {
            let needsUpdate = false;
            let updates = {};
            
            // Vérifier les champs obligatoires manquants
            if (!userProfile.friends) {
                updates.friends = [];
                needsUpdate = true;
            }
            
            if (!userProfile.friendRequests) {
                updates.friendRequests = { sent: [], received: [] };
                needsUpdate = true;
            }
            
            if (!userProfile.firstName) {
                updates.firstName = '';
                needsUpdate = true;
            }
            
            if (!userProfile.lastName) {
                updates.lastName = '';
                needsUpdate = true;
            }
            
            if (!userProfile.email) {
                updates.email = currentUser.email || '';
                needsUpdate = true;
            }
            
            if (!userProfile.address) {
                updates.address = '';
                needsUpdate = true;
            }
            
            if (!userProfile.transportMode) {
                updates.transportMode = '';
                needsUpdate = true;
            }
            
            if (!userProfile.preferences) {
                updates.preferences = '';
                needsUpdate = true;
            }
            
            // Logique simplifiée pour profileCompleted
            const allCurrentFields = {
                firstName: userProfile.firstName || updates.firstName,
                lastName: userProfile.lastName || updates.lastName,
                email: userProfile.email || updates.email,
                address: userProfile.address || updates.address,
                transportMode: userProfile.transportMode || updates.transportMode,
                preferences: userProfile.preferences || updates.preferences
            };
            
            const hasAllRequiredFields = allCurrentFields.firstName?.trim() && 
                                        allCurrentFields.lastName?.trim() && 
                                        allCurrentFields.email?.trim() && 
                                        allCurrentFields.address?.trim() && 
                                        allCurrentFields.transportMode?.trim() && 
                                        allCurrentFields.preferences?.trim();
            
            // Déterminer la valeur correcte pour profileCompleted
            const shouldBeCompleted = hasAllRequiredFields;
            
            if (userProfile.profileCompleted !== shouldBeCompleted) {
                updates.profileCompleted = shouldBeCompleted;
                needsUpdate = true;
            }
            
            // Appliquer les mises à jour si nécessaire
            if (needsUpdate) {
                try {
                    await updateDoc(doc(db, 'users', currentUser.uid), updates);
                    // Mettre à jour le profil local
                    userProfile = { ...userProfile, ...updates };
                    console.log('Profil réparé automatiquement:', updates);
                } catch (error) {
                    console.error('Erreur réparation profil:', error);
                }
            }
            
            return needsUpdate;
        }

        // Mettre à jour l'interface
        function updateUI() {
            // Titre dynamique
            const pageTitle = document.getElementById('page-title');
            const subtitle = document.getElementById('page-subtitle');
            const navDashboard = document.getElementById('nav-dashboard');
            
            if (isNewUser) {
                pageTitle.textContent = 'Finalisons votre profil';
                subtitle.textContent = 'Quelques informations pour personnaliser votre expérience';
                // Cacher le bouton Dashboard pour les vrais nouveaux utilisateurs
                navDashboard.style.display = 'none';
            } else {
                // Utilisateur avec informations de base mais peut-être profil incomplet
                const isComplete = isProfileComplete();
                if (isComplete) {
                    pageTitle.textContent = 'Mon profil';
                    subtitle.textContent = 'Modifiez vos informations personnelles';
                } else {
                    pageTitle.textContent = `Bonjour ${userProfile.firstName}`;
                    subtitle.textContent = 'Complétez votre profil pour accéder au dashboard';
                }
                // Afficher le bouton Dashboard seulement si profil complet
                navDashboard.style.display = isComplete ? 'inline-block' : 'none';
            }

            // Remplir les champs
            document.getElementById('profile-firstName').value = userProfile.firstName || '';
            document.getElementById('profile-lastName').value = userProfile.lastName || '';
            document.getElementById('profile-email').value = userProfile.email || '';
            document.getElementById('profile-address').value = userProfile.address || '';
            document.getElementById('profile-transport').value = userProfile.transportMode || '';
            document.getElementById('profile-preferences').value = userProfile.preferences || '';
        }

        // Vérifier si le profil est complet
        function isProfileComplete() {
            return userProfile.profileCompleted && 
                   userProfile.firstName?.trim() && 
                   userProfile.lastName?.trim() && 
                   userProfile.email?.trim() && 
                   userProfile.address?.trim() && 
                   userProfile.transportMode?.trim() && 
                   userProfile.preferences?.trim();
        }

        // Charger la liste des amis et demandes
        async function loadFriends() {
            try {
                await loadFriendRequests();
                await loadConfirmedFriends();
            } catch (error) {
                console.error('Erreur chargement amis:', error);
            }
        }

        // Charger les demandes d'amitié
        async function loadFriendRequests() {
            try {
                // Demandes reçues
                const receivedContainer = document.getElementById('received-requests');
                const sentContainer = document.getElementById('sent-requests');
                
                if (userProfile.friendRequests) {
                    // Demandes reçues
                    if (userProfile.friendRequests.received && userProfile.friendRequests.received.length > 0) {
                        const receivedHTML = await Promise.all(
                            userProfile.friendRequests.received.map(async (senderUid) => {
                                const senderDoc = await getDoc(doc(db, 'users', senderUid));
                                const senderData = senderDoc.data();
                                return `
                                    <div class="friend-request-item">
                                        <span class="friend-name">${senderData.firstName} ${senderData.lastName}</span>
                                        <span class="friend-email">(${senderData.email})</span>
                                        <div class="request-actions">
                                            <button onclick="acceptFriendRequest('${senderUid}')" class="button-small button-accept">Accepter</button>
                                            <button onclick="rejectFriendRequest('${senderUid}')" class="button-small button-reject">Refuser</button>
                                        </div>
                                    </div>
                                `;
                            })
                        );
                        receivedContainer.innerHTML = receivedHTML.join('');
                    } else {
                        receivedContainer.innerHTML = '<p class="no-requests">Aucune demande reçue</p>';
                    }

                    // Demandes envoyées
                    if (userProfile.friendRequests.sent && userProfile.friendRequests.sent.length > 0) {
                        const sentHTML = await Promise.all(
                            userProfile.friendRequests.sent.map(async (recipientUid) => {
                                const recipientDoc = await getDoc(doc(db, 'users', recipientUid));
                                const recipientData = recipientDoc.data();
                                return `
                                    <div class="friend-request-item">
                                        <span class="friend-name">${recipientData.firstName} ${recipientData.lastName}</span>
                                        <span class="friend-email">(${recipientData.email})</span>
                                        <span class="request-status">En attente...</span>
                                    </div>
                                `;
                            })
                        );
                        sentContainer.innerHTML = sentHTML.join('');
                    } else {
                        sentContainer.innerHTML = '<p class="no-requests">Aucune demande envoyée</p>';
                    }
                } else {
                    receivedContainer.innerHTML = '<p class="no-requests">Aucune demande reçue</p>';
                    sentContainer.innerHTML = '<p class="no-requests">Aucune demande envoyée</p>';
                }
            } catch (error) {
                console.error('Erreur chargement demandes:', error);
            }
        }

        // Charger les amis confirmés
        async function loadConfirmedFriends() {
            try {
                const friendsList = document.getElementById('friends-list');
                
                if (userProfile.friends && userProfile.friends.length > 0) {
                    const friendsHTML = await Promise.all(
                        userProfile.friends.map(async (friendUid) => {
                            const friendDoc = await getDoc(doc(db, 'users', friendUid));
                            const friendData = friendDoc.data();
                            return `
                                <div class="friend-item">
                                    <div class="friend-info">
                                        <span class="friend-name">${friendData.firstName} ${friendData.lastName}</span>
                                        <span class="friend-email">(${friendData.email})</span>
                                    </div>
                                    <button onclick="removeFriend('${friendUid}')" class="button-small button-remove">Supprimer</button>
                                </div>
                            `;
                        })
                    );
                    friendsList.innerHTML = friendsHTML.join('');
                } else {
                    friendsList.innerHTML = '<p class="no-friends">Aucun ami pour le moment</p>';
                }
            } catch (error) {
                console.error('Erreur chargement amis confirmés:', error);
            }
        }

        // Rechercher un utilisateur par email et envoyer une demande d'amitié
        async function sendFriendRequest(email) {
            try {
                // Vérifier que ce n'est pas son propre email
                if (email === currentUser.email) {
                    showMessage('Vous ne pouvez pas vous ajouter vous-même !', 'error');
                    return;
                }

                // Rechercher l'utilisateur par email
                const usersRef = collection(db, 'users');
                const q = query(usersRef, where('email', '==', email));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    showMessage('Aucun utilisateur trouvé avec cette adresse email', 'error');
                    return;
                }

                const targetUserDoc = querySnapshot.docs[0];
                const targetUserData = targetUserDoc.data();
                const targetUid = targetUserDoc.id;

                // Vérifier que les utilisateurs ne sont pas déjà amis
                if (userProfile.friends && userProfile.friends.includes(targetUid)) {
                    showMessage('Vous êtes déjà amis avec cette personne', 'error');
                    return;
                }

                // Vérifier qu'une demande n'a pas déjà été envoyée
                if (userProfile.friendRequests && userProfile.friendRequests.sent && userProfile.friendRequests.sent.includes(targetUid)) {
                    showMessage('Demande déjà envoyée à cette personne', 'error');
                    return;
                }

                // Vérifier qu'une demande n'a pas déjà été reçue de cette personne
                if (userProfile.friendRequests && userProfile.friendRequests.received && userProfile.friendRequests.received.includes(targetUid)) {
                    showMessage('Cette personne vous a déjà envoyé une demande ! Vérifiez vos demandes reçues.', 'error');
                    return;
                }

                // Envoyer la demande d'amitié (Transaction pour cohérence)
                console.log('Envoi demande d\'amitié à:', targetUid);
                
                try {
                    // Étape 1: Ajouter à mes demandes envoyées
                    console.log('Étape 1: Ajout à mes demandes envoyées...');
                    await updateDoc(doc(db, 'users', currentUser.uid), {
                        'friendRequests.sent': arrayUnion(targetUid)
                    });
                    console.log('✅ Étape 1 réussie');

                    // Étape 2: Ajouter à ses demandes reçues
                    console.log('Étape 2: Ajout à ses demandes reçues...');
                    await updateDoc(doc(db, 'users', targetUid), {
                        'friendRequests.received': arrayUnion(currentUser.uid)
                    });
                    console.log('✅ Étape 2 réussie');
                    
                } catch (transactionError) {
                    // En cas d'échec partiel, essayer de nettoyer
                    console.error('❌ Erreur transaction amitié:', transactionError);
                    console.error('Détails erreur:', transactionError.code, transactionError.message);
                    
                    // Tenter de nettoyer la première opération si la seconde échoue
                    try {
                        await updateDoc(doc(db, 'users', currentUser.uid), {
                            'friendRequests.sent': arrayRemove(targetUid)
                        });
                        console.log('🧹 Nettoyage effectué');
                    } catch (cleanupError) {
                        console.error('Erreur lors du nettoyage:', cleanupError);
                    }
                    
                    throw transactionError;
                }

                // Mettre à jour le profil local
                if (!userProfile.friendRequests) userProfile.friendRequests = { sent: [], received: [] };
                if (!userProfile.friendRequests.sent) userProfile.friendRequests.sent = [];
                userProfile.friendRequests.sent.push(targetUid);

                showMessage(`Demande d'amitié envoyée à ${targetUserData.firstName} ${targetUserData.lastName} !`);
                await loadFriendRequests();

            } catch (error) {
                console.error('Erreur envoi demande:', error);
                showMessage('Erreur lors de l\'envoi de la demande', 'error');
            }
        }

        // Accepter une demande d'amitié
        async function acceptFriendRequest(senderUid) {
            try {
                console.log('🤝 Acceptation demande d\'amitié de:', senderUid);
                
                // Étape 1: Mettre à jour MON profil (ajouter ami + retirer demande reçue)
                console.log('Étape 1: Mise à jour de mon profil...');
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    friends: arrayUnion(senderUid),
                    'friendRequests.received': arrayRemove(senderUid)
                });
                console.log('✅ Étape 1 réussie');

                // Étape 2: Mettre à jour SON profil (ajouter ami + retirer demande envoyée)
                console.log('Étape 2: Mise à jour de son profil...');
                await updateDoc(doc(db, 'users', senderUid), {
                    friends: arrayUnion(currentUser.uid),
                    'friendRequests.sent': arrayRemove(currentUser.uid)
                });
                console.log('✅ Étape 2 réussie');

                // Mettre à jour le profil local
                if (!userProfile.friends) userProfile.friends = [];
                userProfile.friends.push(senderUid);
                if (userProfile.friendRequests && userProfile.friendRequests.received) {
                    userProfile.friendRequests.received = userProfile.friendRequests.received.filter(uid => uid !== senderUid);
                }

                showMessage('Demande d\'amitié acceptée !');
                await loadFriendRequests();
                await loadConfirmedFriends();

            } catch (error) {
                console.error('❌ Erreur acceptation demande:', error);
                console.error('Détails erreur:', error.code, error.message);
                
                // En cas d'erreur partielle, essayer de nettoyer les changements
                try {
                    console.log('🧹 Tentative de nettoyage...');
                    await updateDoc(doc(db, 'users', currentUser.uid), {
                        friends: arrayRemove(senderUid),
                        'friendRequests.received': arrayUnion(senderUid)
                    });
                    console.log('🧹 Nettoyage effectué');
                } catch (cleanupError) {
                    console.error('Erreur lors du nettoyage:', cleanupError);
                }
                
                showMessage('Erreur lors de l\'acceptation', 'error');
            }
        }

        // Refuser une demande d'amitié
        async function rejectFriendRequest(senderUid) {
            try {
                // Supprimer des listes de demandes
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    'friendRequests.received': arrayRemove(senderUid)
                });

                await updateDoc(doc(db, 'users', senderUid), {
                    'friendRequests.sent': arrayRemove(currentUser.uid)
                });

                // Mettre à jour le profil local
                if (userProfile.friendRequests && userProfile.friendRequests.received) {
                    userProfile.friendRequests.received = userProfile.friendRequests.received.filter(uid => uid !== senderUid);
                }

                showMessage('Demande d\'amitié refusée');
                await loadFriendRequests();

            } catch (error) {
                console.error('Erreur refus demande:', error);
                showMessage('Erreur lors du refus', 'error');
            }
        }

        // Supprimer un ami
        async function removeFriend(friendUid) {
            try {
                if (!confirm('Êtes-vous sûr de vouloir supprimer cet ami ?')) {
                    return;
                }

                // Supprimer des listes d'amis des deux utilisateurs
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    friends: arrayRemove(friendUid)
                });

                await updateDoc(doc(db, 'users', friendUid), {
                    friends: arrayRemove(currentUser.uid)
                });

                // Mettre à jour le profil local
                if (userProfile.friends) {
                    userProfile.friends = userProfile.friends.filter(uid => uid !== friendUid);
                }

                showMessage('Ami supprimé');
                await loadConfirmedFriends();

            } catch (error) {
                console.error('Erreur suppression ami:', error);
                showMessage('Erreur lors de la suppression', 'error');
            }
        }

        // Afficher/Cacher le loading
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('profile-content').classList.remove('hidden');
        }

        // Gérer la soumission du formulaire
        async function handleProfileSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.textContent;
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Sauvegarde...';

                // Récupérer les données du formulaire
                const formData = new FormData(event.target);
                const profileData = {
                    firstName: formData.get('firstName')?.trim(),
                    lastName: formData.get('lastName')?.trim(),
                    email: formData.get('email')?.trim(),
                    address: formData.get('address')?.trim(),
                    transportMode: formData.get('transportMode'),
                    preferences: formData.get('preferences')?.trim(),
                    profileCompleted: true,
                    lastUpdated: new Date().toISOString()
                };

                // Validation côté client
                if (!profileData.firstName || !profileData.lastName || !profileData.email || 
                    !profileData.address || !profileData.transportMode || !profileData.preferences) {
                    showMessage('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }

                // Validation email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(profileData.email)) {
                    showMessage('Veuillez saisir une adresse email valide', 'error');
                    return;
                }

                // Mise à jour en base
                await updateDoc(doc(db, 'users', currentUser.uid), profileData);
                
                userProfile = { ...userProfile, ...profileData };
                
                showMessage('Profil mis à jour avec succès !');
                
                // Mettre à jour le flag localement pour éviter les problèmes de timing
                userProfile.profileCompleted = true;
                isNewUser = false;
                
                // Redirection vers dashboard après 1 seconde
                setTimeout(() => {
                    console.log('Redirecting to dashboard...');
                    window.location.href = 'dashboard.html';
                }, 1000);

            } catch (error) {
                console.error('Erreur sauvegarde profil:', error);
                showMessage('Erreur lors de la sauvegarde', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        // Déconnexion
        async function logout() {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Erreur déconnexion:', error);
                showMessage('Erreur lors de la déconnexion', 'error');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Formulaire de profil
            const profileForm = document.getElementById('profile-form');
            if (profileForm) {
                profileForm.addEventListener('submit', handleProfileSubmit);
            }

            // Bouton déconnexion
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }

            // Navigation vers dashboard
            const navDashboard = document.getElementById('nav-dashboard');
            if (navDashboard) {
                navDashboard.addEventListener('click', () => {
                    // Vérifier si le profil est complet avant de naviguer
                    if (userProfile && userProfile.profileCompleted) {
                        window.location.href = 'dashboard.html';
                    } else {
                        showMessage('Veuillez d\'abord compléter votre profil', 'error');
                    }
                });
            }

            // Formulaire d'ajout d'ami
            const addFriendForm = document.getElementById('add-friend-form');
            if (addFriendForm) {
                addFriendForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const emailInput = document.getElementById('friend-email');
                    const email = emailInput.value.trim();
                    
                    if (email) {
                        await sendFriendRequest(email);
                        emailInput.value = ''; // Vider le champ après envoi
                    }
                });
            }
        });

        // Exposer les fonctions globalement pour les événements onclick
        window.acceptFriendRequest = acceptFriendRequest;
        window.rejectFriendRequest = rejectFriendRequest;
        window.removeFriend = removeFriend;
    </script>
</head>
<body>
    <div class="background-image"></div>
    <div class="container">
        
        <!-- Indicateur de chargement -->
        <div id="loading" class="loading">
            <h2>Chargement de votre profil...</h2>
            <div class="loading-spinner">⏳</div>
        </div>

        <!-- Contenu du profil -->
        <div id="profile-content" class="profile-content hidden">
            <header class="profile-header">
                <div>
                    <h1 id="page-title">Mon profil</h1>
                    <p id="page-subtitle">Modifiez vos informations personnelles</p>
                </div>
                <div class="header-actions">
                    <button id="nav-dashboard" class="button button-secondary" style="display: none;">
                        Dashboard
                    </button>
                    <button id="logout-btn" class="button-logout">
                        Déconnexion
                    </button>
                </div>
            </header>

            <!-- Formulaire de profil -->
            <form id="profile-form" class="profile-form">
                <!-- Informations personnelles -->
                <section class="form-section">
                    <h3>👤 Informations personnelles</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-firstName">Prénom *</label>
                            <input type="text" id="profile-firstName" name="firstName" placeholder="Votre prénom" required>
                        </div>
                        <div class="form-group">
                            <label for="profile-lastName">Nom *</label>
                            <input type="text" id="profile-lastName" name="lastName" placeholder="Votre nom" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="profile-email">Adresse e-mail *</label>
                        <input type="email" id="profile-email" name="email" placeholder="votre@email.com" required>
                    </div>
                </section>

                <!-- Informations de localisation -->
                <section class="form-section">
                    <h3>📍 Localisation</h3>
                    
                    <div class="form-group">
                        <label for="profile-address">Adresse *</label>
                        <input type="text" id="profile-address" name="address" placeholder="123 Rue de la Paix, 75000 Paris" required>
                    </div>
                </section>

                <!-- Transport -->
                <section class="form-section">
                    <h3>🚗 Moyen de transport</h3>
                    
                    <div class="form-group">
                        <label for="profile-transport">Mode de transport *</label>
                        <select id="profile-transport" name="transportMode" required>
                            <option value="">Sélectionnez votre moyen de transport</option>
                            <option value="bicycle">🚲 Vélo</option>
                            <option value="car">🚗 Voiture</option>
                            <option value="public_transport">🚌 Transport en commun</option>
                        </select>
                    </div>
                </section>

                <!-- Préférences -->
                <section class="form-section">
                    <h3>🍺 Préférences</h3>
                    
                    <div class="form-group">
                        <label for="profile-preferences">Vos préférences *</label>
                        <textarea id="profile-preferences" name="preferences" rows="4" 
                                  placeholder="Décrivez vos préférences : type d'ambiance, musique, nourriture, prix..." required></textarea>
                    </div>
                </section>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" id="submit-btn" class="button">
                        Sauvegarder mon profil
                    </button>
                </div>
            </form>

            <!-- Section amis -->
            <section class="dashboard-section friends-section">
                <h3>👥 Mes amis</h3>
                
                <!-- Ajouter un ami -->
                <div class="add-friend-form">
                    <h4>➕ Ajouter un ami</h4>
                    <form id="add-friend-form" class="inline-form">
                        <div class="form-group-inline">
                            <input type="email" id="friend-email" placeholder="Adresse email de votre ami" required>
                            <button type="submit" class="button button-secondary">Envoyer une demande</button>
                        </div>
                    </form>
                </div>

                <!-- Demandes reçues -->
                <div class="friend-requests-received">
                    <h4>📥 Demandes reçues</h4>
                    <div id="received-requests">
                        <!-- Les demandes reçues seront chargées ici -->
                    </div>
                </div>

                <!-- Demandes envoyées -->
                <div class="friend-requests-sent">
                    <h4>📤 Demandes envoyées</h4>
                    <div id="sent-requests">
                        <!-- Les demandes envoyées seront chargées ici -->
                    </div>
                </div>

                <!-- Liste des amis -->
                <div class="friends-list-container">
                    <h4>✅ Mes amis</h4>
                    <div id="friends-list">
                        <!-- Les amis seront chargés ici -->
                    </div>
                </div>
            </section>
        </div>
    </div>
</body>
</html>
