<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Profil utilisateur - On va o√π ? Compl√©tez vos informations">
    <meta name="theme-color" content="#5d4037">
    <title>Mon Profil - On va o√π ?</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
        import { doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs, arrayUnion, arrayRemove } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

        // Fonction utilitaire pour afficher des messages
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                max-width: 400px;
                background: ${type === 'error' ? '#f44336' : '#4caf50'};
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        let currentUser = null;
        let userProfile = null;
        let isNewUser = false;

        // V√©rifier l'authentification
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadUserProfile();
            } else {
                window.location.href = 'login.html';
            }
        });

        // Charger le profil utilisateur
        async function loadUserProfile() {
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                if (userDoc.exists()) {
                    userProfile = userDoc.data();
                    
                    // V√©rifier et r√©parer la structure du profil
                    const needsRepair = await checkAndRepairProfile();
                    
                    // Distinguer entre "vraiment nouveau" (pas de firstName/lastName) et "profil incomplet"
                    const hasBasicInfo = userProfile.firstName?.trim() && userProfile.lastName?.trim();
                    const hasCompleteProfile = hasBasicInfo && 
                                             userProfile.address?.trim() && 
                                             userProfile.transportMode?.trim() && 
                                             userProfile.preferences?.trim();
                    
                    // Si l'utilisateur a au moins un nom/pr√©nom, ne pas le traiter comme "nouveau"
                    isNewUser = !hasBasicInfo;
                    
                    console.log('Profile check:', {
                        needsRepair,
                        hasBasicInfo,
                        hasCompleteProfile,
                        isNewUser,
                        profileCompleted: userProfile.profileCompleted,
                        firstName: userProfile.firstName,
                        lastName: userProfile.lastName
                    });
                    
                    updateUI();
                    hideLoading();
                    
                    // Charger les amis seulement si le profil est structurellement valide
                    if (!needsRepair) {
                        await loadFriends();
                    }
                } else {
                    // Nouvel utilisateur - cr√©er un profil par d√©faut
                    console.log('Nouveau utilisateur d√©tect√©, cr√©ation du profil par d√©faut...');
                    
                    userProfile = {
                        firstName: '',
                        lastName: '',
                        email: currentUser.email || '',
                        createdAt: new Date().toISOString(),
                        profileCompleted: false,
                        address: '',
                        transportMode: '',
                        preferences: '',
                        friends: [],
                        friendRequests: {
                            sent: [],
                            received: []
                        }
                    };
                    
                    try {
                        await setDoc(doc(db, 'users', currentUser.uid), userProfile);
                        console.log('Profil par d√©faut cr√©√© avec succ√®s');
                    } catch (error) {
                        console.error('Erreur cr√©ation profil par d√©faut:', error);
                        showMessage('Erreur lors de la cr√©ation du profil', 'error');
                    }
                    
                    isNewUser = true;
                    updateUI();
                    hideLoading();
                }
            } catch (error) {
                console.error('Erreur chargement profil:', error);
                showMessage('Erreur lors du chargement des donn√©es', 'error');
                hideLoading(); // Important : arr√™ter le loading m√™me en cas d'erreur
            }
        }

        // V√©rifier et r√©parer la structure du profil
        async function checkAndRepairProfile() {
            let needsUpdate = false;
            let updates = {};
            
            // V√©rifier les champs obligatoires manquants
            if (!userProfile.friends) {
                updates.friends = [];
                needsUpdate = true;
            }
            
            if (!userProfile.friendRequests) {
                updates.friendRequests = { sent: [], received: [] };
                needsUpdate = true;
            }
            
            if (!userProfile.firstName) {
                updates.firstName = '';
                needsUpdate = true;
            }
            
            if (!userProfile.lastName) {
                updates.lastName = '';
                needsUpdate = true;
            }
            
            if (!userProfile.email) {
                updates.email = currentUser.email || '';
                needsUpdate = true;
            }
            
            if (!userProfile.address) {
                updates.address = '';
                needsUpdate = true;
            }
            
            if (!userProfile.transportMode) {
                updates.transportMode = '';
                needsUpdate = true;
            }
            
            if (!userProfile.preferences) {
                updates.preferences = '';
                needsUpdate = true;
            }
            
            // Logique simplifi√©e pour profileCompleted
            const allCurrentFields = {
                firstName: userProfile.firstName || updates.firstName,
                lastName: userProfile.lastName || updates.lastName,
                email: userProfile.email || updates.email,
                address: userProfile.address || updates.address,
                transportMode: userProfile.transportMode || updates.transportMode,
                preferences: userProfile.preferences || updates.preferences
            };
            
            const hasAllRequiredFields = allCurrentFields.firstName?.trim() && 
                                        allCurrentFields.lastName?.trim() && 
                                        allCurrentFields.email?.trim() && 
                                        allCurrentFields.address?.trim() && 
                                        allCurrentFields.transportMode?.trim() && 
                                        allCurrentFields.preferences?.trim();
            
            // D√©terminer la valeur correcte pour profileCompleted
            const shouldBeCompleted = hasAllRequiredFields;
            
            if (userProfile.profileCompleted !== shouldBeCompleted) {
                updates.profileCompleted = shouldBeCompleted;
                needsUpdate = true;
            }
            
            // Appliquer les mises √† jour si n√©cessaire
            if (needsUpdate) {
                try {
                    await updateDoc(doc(db, 'users', currentUser.uid), updates);
                    // Mettre √† jour le profil local
                    userProfile = { ...userProfile, ...updates };
                    console.log('Profil r√©par√© automatiquement:', updates);
                } catch (error) {
                    console.error('Erreur r√©paration profil:', error);
                }
            }
            
            return needsUpdate;
        }

        // Mettre √† jour l'interface
        function updateUI() {
            // Titre dynamique
            const pageTitle = document.getElementById('page-title');
            const subtitle = document.getElementById('page-subtitle');
            const navDashboard = document.getElementById('nav-dashboard');
            
            if (isNewUser) {
                pageTitle.textContent = 'Finalisons votre profil';
                subtitle.textContent = 'Quelques informations pour personnaliser votre exp√©rience';
                // Cacher le bouton Dashboard pour les vrais nouveaux utilisateurs
                navDashboard.style.display = 'none';
            } else {
                // Utilisateur avec informations de base mais peut-√™tre profil incomplet
                const isComplete = isProfileComplete();
                if (isComplete) {
                    pageTitle.textContent = 'Mon profil';
                    subtitle.textContent = 'Modifiez vos informations personnelles';
                } else {
                    pageTitle.textContent = `Bonjour ${userProfile.firstName}`;
                    subtitle.textContent = 'Compl√©tez votre profil pour acc√©der au dashboard';
                }
                // Afficher le bouton Dashboard seulement si profil complet
                navDashboard.style.display = isComplete ? 'inline-block' : 'none';
            }

            // Remplir les champs
            document.getElementById('profile-firstName').value = userProfile.firstName || '';
            document.getElementById('profile-lastName').value = userProfile.lastName || '';
            document.getElementById('profile-email').value = userProfile.email || '';
            document.getElementById('profile-address').value = userProfile.address || '';
            document.getElementById('profile-transport').value = userProfile.transportMode || '';
            document.getElementById('profile-preferences').value = userProfile.preferences || '';
        }

        // V√©rifier si le profil est complet
        function isProfileComplete() {
            return userProfile.profileCompleted && 
                   userProfile.firstName?.trim() && 
                   userProfile.lastName?.trim() && 
                   userProfile.email?.trim() && 
                   userProfile.address?.trim() && 
                   userProfile.transportMode?.trim() && 
                   userProfile.preferences?.trim();
        }

        // Charger la liste des amis et demandes
        async function loadFriends() {
            try {
                await loadFriendRequests();
                await loadConfirmedFriends();
            } catch (error) {
                console.error('Erreur chargement amis:', error);
            }
        }

        // Charger les demandes d'amiti√©
        async function loadFriendRequests() {
            try {
                // Demandes re√ßues
                const receivedContainer = document.getElementById('received-requests');
                const sentContainer = document.getElementById('sent-requests');
                
                if (userProfile.friendRequests) {
                    // Demandes re√ßues
                    if (userProfile.friendRequests.received && userProfile.friendRequests.received.length > 0) {
                        const receivedHTML = await Promise.all(
                            userProfile.friendRequests.received.map(async (senderUid) => {
                                const senderDoc = await getDoc(doc(db, 'users', senderUid));
                                const senderData = senderDoc.data();
                                return `
                                    <div class="friend-request-item">
                                        <span class="friend-name">${senderData.firstName} ${senderData.lastName}</span>
                                        <span class="friend-email">(${senderData.email})</span>
                                        <div class="request-actions">
                                            <button onclick="acceptFriendRequest('${senderUid}')" class="button-small button-accept">Accepter</button>
                                            <button onclick="rejectFriendRequest('${senderUid}')" class="button-small button-reject">Refuser</button>
                                        </div>
                                    </div>
                                `;
                            })
                        );
                        receivedContainer.innerHTML = receivedHTML.join('');
                    } else {
                        receivedContainer.innerHTML = '<p class="no-requests">Aucune demande re√ßue</p>';
                    }

                    // Demandes envoy√©es
                    if (userProfile.friendRequests.sent && userProfile.friendRequests.sent.length > 0) {
                        const sentHTML = await Promise.all(
                            userProfile.friendRequests.sent.map(async (recipientUid) => {
                                const recipientDoc = await getDoc(doc(db, 'users', recipientUid));
                                const recipientData = recipientDoc.data();
                                return `
                                    <div class="friend-request-item">
                                        <span class="friend-name">${recipientData.firstName} ${recipientData.lastName}</span>
                                        <span class="friend-email">(${recipientData.email})</span>
                                        <span class="request-status">En attente...</span>
                                    </div>
                                `;
                            })
                        );
                        sentContainer.innerHTML = sentHTML.join('');
                    } else {
                        sentContainer.innerHTML = '<p class="no-requests">Aucune demande envoy√©e</p>';
                    }
                } else {
                    receivedContainer.innerHTML = '<p class="no-requests">Aucune demande re√ßue</p>';
                    sentContainer.innerHTML = '<p class="no-requests">Aucune demande envoy√©e</p>';
                }
            } catch (error) {
                console.error('Erreur chargement demandes:', error);
            }
        }

        // Charger les amis confirm√©s
        async function loadConfirmedFriends() {
            try {
                const friendsList = document.getElementById('friends-list');
                
                if (userProfile.friends && userProfile.friends.length > 0) {
                    const friendsHTML = await Promise.all(
                        userProfile.friends.map(async (friendUid) => {
                            const friendDoc = await getDoc(doc(db, 'users', friendUid));
                            const friendData = friendDoc.data();
                            return `
                                <div class="friend-item">
                                    <div class="friend-info">
                                        <span class="friend-name">${friendData.firstName} ${friendData.lastName}</span>
                                        <span class="friend-email">(${friendData.email})</span>
                                    </div>
                                    <button onclick="removeFriend('${friendUid}')" class="button-small button-remove">Supprimer</button>
                                </div>
                            `;
                        })
                    );
                    friendsList.innerHTML = friendsHTML.join('');
                } else {
                    friendsList.innerHTML = '<p class="no-friends">Aucun ami pour le moment</p>';
                }
            } catch (error) {
                console.error('Erreur chargement amis confirm√©s:', error);
            }
        }

        // Rechercher un utilisateur par email et envoyer une demande d'amiti√©
        async function sendFriendRequest(email) {
            try {
                // V√©rifier que ce n'est pas son propre email
                if (email === currentUser.email) {
                    showMessage('Vous ne pouvez pas vous ajouter vous-m√™me !', 'error');
                    return;
                }

                // Rechercher l'utilisateur par email
                const usersRef = collection(db, 'users');
                const q = query(usersRef, where('email', '==', email));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    showMessage('Aucun utilisateur trouv√© avec cette adresse email', 'error');
                    return;
                }

                const targetUserDoc = querySnapshot.docs[0];
                const targetUserData = targetUserDoc.data();
                const targetUid = targetUserDoc.id;

                // V√©rifier que les utilisateurs ne sont pas d√©j√† amis
                if (userProfile.friends && userProfile.friends.includes(targetUid)) {
                    showMessage('Vous √™tes d√©j√† amis avec cette personne', 'error');
                    return;
                }

                // V√©rifier qu'une demande n'a pas d√©j√† √©t√© envoy√©e
                if (userProfile.friendRequests && userProfile.friendRequests.sent && userProfile.friendRequests.sent.includes(targetUid)) {
                    showMessage('Demande d√©j√† envoy√©e √† cette personne', 'error');
                    return;
                }

                // V√©rifier qu'une demande n'a pas d√©j√† √©t√© re√ßue de cette personne
                if (userProfile.friendRequests && userProfile.friendRequests.received && userProfile.friendRequests.received.includes(targetUid)) {
                    showMessage('Cette personne vous a d√©j√† envoy√© une demande ! V√©rifiez vos demandes re√ßues.', 'error');
                    return;
                }

                // Envoyer la demande d'amiti√© (Transaction pour coh√©rence)
                console.log('Envoi demande d\'amiti√© √†:', targetUid);
                
                try {
                    // √âtape 1: Ajouter √† mes demandes envoy√©es
                    console.log('√âtape 1: Ajout √† mes demandes envoy√©es...');
                    await updateDoc(doc(db, 'users', currentUser.uid), {
                        'friendRequests.sent': arrayUnion(targetUid)
                    });
                    console.log('‚úÖ √âtape 1 r√©ussie');

                    // √âtape 2: Ajouter √† ses demandes re√ßues
                    console.log('√âtape 2: Ajout √† ses demandes re√ßues...');
                    await updateDoc(doc(db, 'users', targetUid), {
                        'friendRequests.received': arrayUnion(currentUser.uid)
                    });
                    console.log('‚úÖ √âtape 2 r√©ussie');
                    
                } catch (transactionError) {
                    // En cas d'√©chec partiel, essayer de nettoyer
                    console.error('‚ùå Erreur transaction amiti√©:', transactionError);
                    console.error('D√©tails erreur:', transactionError.code, transactionError.message);
                    
                    // Tenter de nettoyer la premi√®re op√©ration si la seconde √©choue
                    try {
                        await updateDoc(doc(db, 'users', currentUser.uid), {
                            'friendRequests.sent': arrayRemove(targetUid)
                        });
                        console.log('üßπ Nettoyage effectu√©');
                    } catch (cleanupError) {
                        console.error('Erreur lors du nettoyage:', cleanupError);
                    }
                    
                    throw transactionError;
                }

                // Mettre √† jour le profil local
                if (!userProfile.friendRequests) userProfile.friendRequests = { sent: [], received: [] };
                if (!userProfile.friendRequests.sent) userProfile.friendRequests.sent = [];
                userProfile.friendRequests.sent.push(targetUid);

                showMessage(`Demande d'amiti√© envoy√©e √† ${targetUserData.firstName} ${targetUserData.lastName} !`);
                await loadFriendRequests();

            } catch (error) {
                console.error('Erreur envoi demande:', error);
                showMessage('Erreur lors de l\'envoi de la demande', 'error');
            }
        }

        // Accepter une demande d'amiti√©
        async function acceptFriendRequest(senderUid) {
            try {
                console.log('ü§ù Acceptation demande d\'amiti√© de:', senderUid);
                
                // √âtape 1: Mettre √† jour MON profil (ajouter ami + retirer demande re√ßue)
                console.log('√âtape 1: Mise √† jour de mon profil...');
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    friends: arrayUnion(senderUid),
                    'friendRequests.received': arrayRemove(senderUid)
                });
                console.log('‚úÖ √âtape 1 r√©ussie');

                // √âtape 2: Mettre √† jour SON profil (ajouter ami + retirer demande envoy√©e)
                console.log('√âtape 2: Mise √† jour de son profil...');
                await updateDoc(doc(db, 'users', senderUid), {
                    friends: arrayUnion(currentUser.uid),
                    'friendRequests.sent': arrayRemove(currentUser.uid)
                });
                console.log('‚úÖ √âtape 2 r√©ussie');

                // Mettre √† jour le profil local
                if (!userProfile.friends) userProfile.friends = [];
                userProfile.friends.push(senderUid);
                if (userProfile.friendRequests && userProfile.friendRequests.received) {
                    userProfile.friendRequests.received = userProfile.friendRequests.received.filter(uid => uid !== senderUid);
                }

                showMessage('Demande d\'amiti√© accept√©e !');
                await loadFriendRequests();
                await loadConfirmedFriends();

            } catch (error) {
                console.error('‚ùå Erreur acceptation demande:', error);
                console.error('D√©tails erreur:', error.code, error.message);
                
                // En cas d'erreur partielle, essayer de nettoyer les changements
                try {
                    console.log('üßπ Tentative de nettoyage...');
                    await updateDoc(doc(db, 'users', currentUser.uid), {
                        friends: arrayRemove(senderUid),
                        'friendRequests.received': arrayUnion(senderUid)
                    });
                    console.log('üßπ Nettoyage effectu√©');
                } catch (cleanupError) {
                    console.error('Erreur lors du nettoyage:', cleanupError);
                }
                
                showMessage('Erreur lors de l\'acceptation', 'error');
            }
        }

        // Refuser une demande d'amiti√©
        async function rejectFriendRequest(senderUid) {
            try {
                // Supprimer des listes de demandes
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    'friendRequests.received': arrayRemove(senderUid)
                });

                await updateDoc(doc(db, 'users', senderUid), {
                    'friendRequests.sent': arrayRemove(currentUser.uid)
                });

                // Mettre √† jour le profil local
                if (userProfile.friendRequests && userProfile.friendRequests.received) {
                    userProfile.friendRequests.received = userProfile.friendRequests.received.filter(uid => uid !== senderUid);
                }

                showMessage('Demande d\'amiti√© refus√©e');
                await loadFriendRequests();

            } catch (error) {
                console.error('Erreur refus demande:', error);
                showMessage('Erreur lors du refus', 'error');
            }
        }

        // Supprimer un ami
        async function removeFriend(friendUid) {
            try {
                if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet ami ?')) {
                    return;
                }

                // Supprimer des listes d'amis des deux utilisateurs
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    friends: arrayRemove(friendUid)
                });

                await updateDoc(doc(db, 'users', friendUid), {
                    friends: arrayRemove(currentUser.uid)
                });

                // Mettre √† jour le profil local
                if (userProfile.friends) {
                    userProfile.friends = userProfile.friends.filter(uid => uid !== friendUid);
                }

                showMessage('Ami supprim√©');
                await loadConfirmedFriends();

            } catch (error) {
                console.error('Erreur suppression ami:', error);
                showMessage('Erreur lors de la suppression', 'error');
            }
        }

        // Afficher/Cacher le loading
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('profile-content').classList.remove('hidden');
        }

        // G√©rer la soumission du formulaire
        async function handleProfileSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.textContent;
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Sauvegarde...';

                // R√©cup√©rer les donn√©es du formulaire
                const formData = new FormData(event.target);
                const profileData = {
                    firstName: formData.get('firstName')?.trim(),
                    lastName: formData.get('lastName')?.trim(),
                    email: formData.get('email')?.trim(),
                    address: formData.get('address')?.trim(),
                    transportMode: formData.get('transportMode'),
                    preferences: formData.get('preferences')?.trim(),
                    profileCompleted: true,
                    lastUpdated: new Date().toISOString()
                };

                // Validation c√¥t√© client
                if (!profileData.firstName || !profileData.lastName || !profileData.email || 
                    !profileData.address || !profileData.transportMode || !profileData.preferences) {
                    showMessage('Veuillez remplir tous les champs obligatoires', 'error');
                    return;
                }

                // Validation email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(profileData.email)) {
                    showMessage('Veuillez saisir une adresse email valide', 'error');
                    return;
                }

                // Mise √† jour en base
                await updateDoc(doc(db, 'users', currentUser.uid), profileData);
                
                userProfile = { ...userProfile, ...profileData };
                
                showMessage('Profil mis √† jour avec succ√®s !');
                
                // Mettre √† jour le flag localement pour √©viter les probl√®mes de timing
                userProfile.profileCompleted = true;
                isNewUser = false;
                
                // Redirection vers dashboard apr√®s 1 seconde
                setTimeout(() => {
                    console.log('Redirecting to dashboard...');
                    window.location.href = 'dashboard.html';
                }, 1000);

            } catch (error) {
                console.error('Erreur sauvegarde profil:', error);
                showMessage('Erreur lors de la sauvegarde', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        // D√©connexion
        async function logout() {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Erreur d√©connexion:', error);
                showMessage('Erreur lors de la d√©connexion', 'error');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Formulaire de profil
            const profileForm = document.getElementById('profile-form');
            if (profileForm) {
                profileForm.addEventListener('submit', handleProfileSubmit);
            }

            // Bouton d√©connexion
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }

            // Navigation vers dashboard
            const navDashboard = document.getElementById('nav-dashboard');
            if (navDashboard) {
                navDashboard.addEventListener('click', () => {
                    // V√©rifier si le profil est complet avant de naviguer
                    if (userProfile && userProfile.profileCompleted) {
                        window.location.href = 'dashboard.html';
                    } else {
                        showMessage('Veuillez d\'abord compl√©ter votre profil', 'error');
                    }
                });
            }

            // Formulaire d'ajout d'ami
            const addFriendForm = document.getElementById('add-friend-form');
            if (addFriendForm) {
                addFriendForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const emailInput = document.getElementById('friend-email');
                    const email = emailInput.value.trim();
                    
                    if (email) {
                        await sendFriendRequest(email);
                        emailInput.value = ''; // Vider le champ apr√®s envoi
                    }
                });
            }
        });

        // Exposer les fonctions globalement pour les √©v√©nements onclick
        window.acceptFriendRequest = acceptFriendRequest;
        window.rejectFriendRequest = rejectFriendRequest;
        window.removeFriend = removeFriend;
    </script>
</head>
<body>
    <div class="background-image"></div>
    <div class="container">
        
        <!-- Indicateur de chargement -->
        <div id="loading" class="loading">
            <h2>Chargement de votre profil...</h2>
            <div class="loading-spinner">‚è≥</div>
        </div>

        <!-- Contenu du profil -->
        <div id="profile-content" class="profile-content hidden">
            <header class="profile-header">
                <div>
                    <h1 id="page-title">Mon profil</h1>
                    <p id="page-subtitle">Modifiez vos informations personnelles</p>
                </div>
                <div class="header-actions">
                    <button id="nav-dashboard" class="button button-secondary" style="display: none;">
                        Dashboard
                    </button>
                    <button id="logout-btn" class="button-logout">
                        D√©connexion
                    </button>
                </div>
            </header>

            <!-- Formulaire de profil -->
            <form id="profile-form" class="profile-form">
                <!-- Informations personnelles -->
                <section class="form-section">
                    <h3>üë§ Informations personnelles</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-firstName">Pr√©nom *</label>
                            <input type="text" id="profile-firstName" name="firstName" placeholder="Votre pr√©nom" required>
                        </div>
                        <div class="form-group">
                            <label for="profile-lastName">Nom *</label>
                            <input type="text" id="profile-lastName" name="lastName" placeholder="Votre nom" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="profile-email">Adresse e-mail *</label>
                        <input type="email" id="profile-email" name="email" placeholder="votre@email.com" required>
                    </div>
                </section>

                <!-- Informations de localisation -->
                <section class="form-section">
                    <h3>üìç Localisation</h3>
                    
                    <div class="form-group">
                        <label for="profile-address">Adresse *</label>
                        <input type="text" id="profile-address" name="address" placeholder="123 Rue de la Paix, 75000 Paris" required>
                    </div>
                </section>

                <!-- Transport -->
                <section class="form-section">
                    <h3>üöó Moyen de transport</h3>
                    
                    <div class="form-group">
                        <label for="profile-transport">Mode de transport *</label>
                        <select id="profile-transport" name="transportMode" required>
                            <option value="">S√©lectionnez votre moyen de transport</option>
                            <option value="bicycle">üö≤ V√©lo</option>
                            <option value="car">üöó Voiture</option>
                            <option value="public_transport">üöå Transport en commun</option>
                        </select>
                    </div>
                </section>

                <!-- Pr√©f√©rences -->
                <section class="form-section">
                    <h3>üç∫ Pr√©f√©rences</h3>
                    
                    <div class="form-group">
                        <label for="profile-preferences">Vos pr√©f√©rences *</label>
                        <textarea id="profile-preferences" name="preferences" rows="4" 
                                  placeholder="D√©crivez vos pr√©f√©rences : type d'ambiance, musique, nourriture, prix..." required></textarea>
                    </div>
                </section>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" id="submit-btn" class="button">
                        Sauvegarder mon profil
                    </button>
                </div>
            </form>

            <!-- Section amis -->
            <section class="dashboard-section friends-section">
                <h3>üë• Mes amis</h3>
                
                <!-- Ajouter un ami -->
                <div class="add-friend-form">
                    <h4>‚ûï Ajouter un ami</h4>
                    <form id="add-friend-form" class="inline-form">
                        <div class="form-group-inline">
                            <input type="email" id="friend-email" placeholder="Adresse email de votre ami" required>
                            <button type="submit" class="button button-secondary">Envoyer une demande</button>
                        </div>
                    </form>
                </div>

                <!-- Demandes re√ßues -->
                <div class="friend-requests-received">
                    <h4>üì• Demandes re√ßues</h4>
                    <div id="received-requests">
                        <!-- Les demandes re√ßues seront charg√©es ici -->
                    </div>
                </div>

                <!-- Demandes envoy√©es -->
                <div class="friend-requests-sent">
                    <h4>üì§ Demandes envoy√©es</h4>
                    <div id="sent-requests">
                        <!-- Les demandes envoy√©es seront charg√©es ici -->
                    </div>
                </div>

                <!-- Liste des amis -->
                <div class="friends-list-container">
                    <h4>‚úÖ Mes amis</h4>
                    <div id="friends-list">
                        <!-- Les amis seront charg√©s ici -->
                    </div>
                </div>
            </section>
        </div>
    </div>
</body>
</html>
