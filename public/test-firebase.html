<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase - On va où ?</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 8px; }
        button { background: #5d4037; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        #status { background: #e8f5e8; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>🧪 Test Firebase Configuration</h1>
    
    <div class="test-section">
        <h2>📡 Test de connexion Firebase</h2>
        <button onclick="testFirebaseConnection()">Tester la connexion</button>
        <div id="connection-status"></div>
    </div>

    <div class="test-section">
        <h2>👤 Test Authentication</h2>
        <div>
            <input type="email" id="test-email" placeholder="email@example.com">
            <input type="password" id="test-password" placeholder="password">
        </div>
        <button onclick="testRegister()">Test Inscription</button>
        <button onclick="testLogin()">Test Connexion</button>
        <button onclick="testLogout()">Déconnexion</button>
        <div id="auth-status"></div>
    </div>

    <div class="test-section">
        <h2>📊 Test Firestore</h2>
        <button onclick="testFirestore()">Test écriture/lecture Firestore</button>
        <div id="firestore-status"></div>
    </div>

    <div id="status"></div>

    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth';
        import { doc, setDoc, getDoc } from 'firebase/firestore';

        // Test de connexion Firebase
        window.testFirebaseConnection = () => {
            const status = document.getElementById('connection-status');
            try {
                status.innerHTML = `
                    ✅ <strong>Firebase configuré !</strong><br>
                    📋 Project ID: ${auth.app.options.projectId}<br>
                    🌐 Auth Domain: ${auth.app.options.authDomain}
                `;
                status.style.background = '#e8f5e8';
            } catch (error) {
                status.innerHTML = `❌ Erreur: ${error.message}`;
                status.style.background = '#ffeaea';
            }
        };

        // Test inscription
        window.testRegister = async () => {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            const status = document.getElementById('auth-status');

            if (!email || !password) {
                status.innerHTML = '⚠️ Veuillez saisir email et mot de passe';
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                status.innerHTML = `✅ Inscription réussie ! UID: ${userCredential.user.uid}`;
                status.style.background = '#e8f5e8';
            } catch (error) {
                status.innerHTML = `❌ Erreur inscription: ${error.message}`;
                status.style.background = '#ffeaea';
            }
        };

        // Test connexion
        window.testLogin = async () => {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            const status = document.getElementById('auth-status');

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                status.innerHTML = `✅ Connexion réussie ! UID: ${userCredential.user.uid}`;
                status.style.background = '#e8f5e8';
            } catch (error) {
                status.innerHTML = `❌ Erreur connexion: ${error.message}`;
                status.style.background = '#ffeaea';
            }
        };

        // Test déconnexion
        window.testLogout = async () => {
            const status = document.getElementById('auth-status');
            try {
                await signOut(auth);
                status.innerHTML = '✅ Déconnexion réussie';
                status.style.background = '#e8f5e8';
            } catch (error) {
                status.innerHTML = `❌ Erreur déconnexion: ${error.message}`;
                status.style.background = '#ffeaea';
            }
        };

        // Test Firestore
        window.testFirestore = async () => {
            const status = document.getElementById('firestore-status');
            
            if (!auth.currentUser) {
                status.innerHTML = '⚠️ Vous devez être connecté pour tester Firestore';
                return;
            }

            try {
                const testData = {
                    message: 'Test Firebase config',
                    timestamp: new Date(),
                    status: 'working'
                };

                // Écriture
                await setDoc(doc(db, 'tests', 'config-test'), testData);
                
                // Lecture
                const docSnap = await getDoc(doc(db, 'tests', 'config-test'));
                
                if (docSnap.exists()) {
                    status.innerHTML = `✅ Firestore fonctionne ! Données: ${JSON.stringify(docSnap.data(), null, 2)}`;
                    status.style.background = '#e8f5e8';
                } else {
                    status.innerHTML = '❌ Document non trouvé';
                    status.style.background = '#ffeaea';
                }
            } catch (error) {
                status.innerHTML = `❌ Erreur Firestore: ${error.message}`;
                status.style.background = '#ffeaea';
            }
        };

        // Surveiller l'état d'authentification
        onAuthStateChanged(auth, (user) => {
            const globalStatus = document.getElementById('status');
            if (user) {
                globalStatus.innerHTML = `🟢 Utilisateur connecté: ${user.email} (UID: ${user.uid})`;
            } else {
                globalStatus.innerHTML = '🔴 Aucun utilisateur connecté';
            }
        });

        // Test automatique de la connexion au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                testFirebaseConnection();
            }, 1000);
        });
    </script>
</body>
</html>
